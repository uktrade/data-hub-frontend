{% from "_macros/form.njk" import FormGroup, Fieldset, TextField, AddAnother, MultipleChoiceField, HiddenField, DateFieldset, Typeahead, Search %}
{% from "_macros/form.njk" import EntitySearchForm, Form, MultiStepForm with context %}
{% from "_macros/common.njk" import LocalHeader with context %}
{% from "_macros/common.njk" import Message, MessageList, Breadcrumbs, Pagination, GlobalNav, LocalNav, Progress, FromNow, AnswersSummary, HiddenContent %}
{% from "_macros/collection.njk" import CollectionContent, CollectionFilters %}
{% from "_macros/entity.njk" import MetaList %}

{% if IS_XHR %}
  {% extends "./xhr.njk" %}
{% else %}
  {% extends "./dit-base.njk" %}
{% endif %}

{% set pageTitle = [getPageTitle() if getPageTitle, 'DIT Data Hub'] | removeNilAndEmpty | flatten | join(' - ') %}

{% block head %}
  {{ super() }}

  {% include "_includes/google-tag-manager-snippet.njk" %}
{% endblock %}

{% block header_menu %}
  <nav aria-label="global nav">
    <ul class="proposition-menu">
      {% if feedbackLink %}
        <li class="proposition-menu__item">
          <a href="{{ feedbackLink }}"
             class="proposition-menu__link {{ 'is-active' if CURRENT_PATH and '/support' in CURRENT_PATH }}">Support</a>
        </li>
      {% endif %}
      {% if user %}
        <li class="proposition-menu__item">
          <a href="/profile" class="proposition-menu__link {{ 'is-active' if CURRENT_PATH == '/profile' }}">{{ user.name }}</a>
        </li>
      {% endif %}
      {% if user %}
        <li class="proposition-menu__item">
            <a href="/oauth/sign-out" class="proposition-menu__link">Sign out</a>
        </li>
      {% endif %}
    </ul>
  </nav>
{% endblock %}

{% block body_site_header %}
  {{ super() }}

  {{ GlobalNav({ items: GLOBAL_NAV_ITEMS }) if user }}
{% endblock %}

{% block body_main_header %}
  {{ super() }}

  {% block local_header %}
    {% set pageTitle = getPageTitle() if getPageTitle %}
    {% set heading = heading or pageTitle[0] %}
    {{ LocalHeader({ heading: heading, modifier: 'light-banner' }) }}
  {% endblock %}
{% endblock %}

{% block body %}
  {% include "_includes/google-tag-manager-no-script.njk" %}
  {{ super() }}
  <!--[if gt IE 8]><!-->
    {% block javascript %}
      <script src="{{ getAssetPath('app.js') }}"></script>
    {% endblock %}
  <!--<![endif]-->
{% endblock %}

{% block body_footer %}{% endblock %}
